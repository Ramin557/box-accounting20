/*
** persian-datepicker - v1.2.0
** Reza Babakhani <babakhani.reza@gmail.com>
** http://babakhani.github.io/PersianWebToolkit/docs/datepicker
** Under MIT license 
*/

!function(e,t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jquery")):t(e.jQuery)}(this,function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),n=function(){function n(i,a){t(this,n),this.options=e.extend(!0,this.defaultOptions,a||{}),this.element=i}return i(n,[{key:"enable",value:function(){this.element.prop("disabled",!1),this.onSelect=function(e){},this._attachedEvents=[],this.element.addClass("pwt-datepicker-input-element"),this.createPicker()}},{key:"disable",value:function(){this.element.attr("disabled","disabled")}},{key:"show",value:function(){this.picker.show(),this.options.onShow(this.calendar),this._attachEvents()}},{key:"hide",value:function(){this.picker.hide(),this.options.onHide(this.calendar),this._detachEvents()}},{key:"destroy",value:function(){this._detachEvents(),this.picker.remove()}},{key:"_attachEvents",value:function(){e(document).on("click",this._handleDocumentClick.bind(this)),e(document).on("keydown",this._handleKeyboard.bind(this)),this._attachedEvents.push([document,{click:this._handleDocumentClick,keydown:this._handleKeyboard}])}},{key:"_detachEvents",value:function(){for(var t=this._attachedEvents.length-1;t>=0;t--){var i=this._attachedEvents[t];e(i[0]).off(Object.keys(i[1])[0],i[1][Object.keys(i[1])[0]])}this._attachedEvents=[]}},{key:"_handleKeyboard",value:function(e){switch(e.which){case 9:this.hide();break;case 13:this.options.onSelect(this.calendar.getDate()),this.hide();break;case 27:this.hide()}}},{key:"_handleDocumentClick",value:function(t){this.element.is(t.target)||this.picker.is(t.target)||0!==this.picker.has(t.target).length||this.hide()}},{key:"createPicker",value:function(){var t=this;this.calendar=new persianDate(this.options.initialValue),this.calendar.toCalendar(this.options.calendar),this.calendar.toLocale(this.options.locale),this.calendar.toLeapYearMode(this.options.leapYearMode),this.calendar.toFormat(this.options.format),this.options.altField&&e(this.options.altField).val(this.calendar.getDate().format(this.options.altFormat)),this.options.altFormat&&e(this.options.altField).val(this.calendar.getDate().format(this.options.altFormat)),this.options.initialValue&&this.element.val(this.calendar.getDate().format(this.options.format)),this.options.observer&&this.options.observer.enabled&&this.observeInput(),this.options.inputDelay&&this._attachInputElementEvents(),this.picker=e('<div class="datepicker-container"></div>').css({left:0,top:this.element.position().top+this.element.outerHeight()}),this.options.template?this.picker.html(this.options.template):this.picker.load(this.options.template,function(){t.options.onTemplateReady(t.calendar)}),this.container=e("body"),this.options.container&&(this.container=e(this.options.container)),this.container.append(this.picker),this.options.autoShow&&this.show(),this.options.onCreateCalender(this.calendar)}},{key:"_attachInputElementEvents",value:function(){var t=this,i=void 0;this.element.on("keyup",function(n){if("Enter"!=n.key)if("Escape"!=n.key){var a=t.element.val();i&&clearTimeout(i),i=setTimeout(function(){t.options.inputDelay.formatter&&t.options.inputDelay.formatter(a),t.calendar.parse(a),t.options.inputDelay.onChangeDate(t.calendar.getDate()),t.options.onSelect(t.calendar.getDate())},t.options.inputDelay.delay||0)}else t.hide();else t.options.onSelect(t.calendar.getDate()),t.hide()})}},{key:"observeInput",value:function(){var t=this;new MutationObserver(function(e){e.forEach(function(e){"attributes"===e.type&&"value"===e.attributeName&&t.calendar.parse(t.element.val())})}).observe(this.element[0],{attributes:!0})}},{key:"defaultOptions",get:function(){return{template:null,inputDelay:0,observer:{enabled:!1},inputFormat:"YYYY/MM/DD",format:"YYYY/MM/DD",formatter:function(e){return e},altField:!1,altFormat:"unix",initialValue:!1,initialValueType:"gregorian",persianDigit:!1,autoShow:!1,calendar:"persian",locale:"fa",leapYearMode:"algorithmic",container:"",onCreateCalender:function(){},onChangeMonth:function(){},onChangeYear:function(){},onChangeDate:function(){},onSelect:function(){},onShow:function(){},onHide:function(){},onTemplateReady:function(){}}}}]),n}();e.fn.persianDatepicker=e.fn.pDatepicker=function(t){var i=Array.prototype.slice.call(arguments),a=null,s=this;if(1===this.length)return a=new n(this,t),this.data("datepicker",a),a;if(this.length>1)return this.each(function(){s.data("datepicker",new n(e(this),t))});if(0!==i.length&&"string"==typeof i[0]){if(a=this.data("datepicker"),!a)throw new Error('Persian Datepicker on this element is not initialized. please use .persianDatepicker() for initialize');if(!a[i[0]])throw new Error('Persian Datepicker method: "+i[0]+" not exist');return a[i[0]].apply(a,i.slice(1))}return this}});