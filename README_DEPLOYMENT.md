# ุฑุงูููุง ุงุณุชูุฑุงุฑ ุณุณุชู ุญุณุงุจุฏุงุฑ ูุงุฑุณ
# Persian Accounting System Deployment Guide

## ุงุณุชูุฑุงุฑ ุฏุฑ ูุญุท ุฌุฏุฏ (Deploying to a New Environment)

ูุฑ ููุช ุงู ูพุฑูฺู ุฑุง ุฏุฑ ูุญุท ุฌุฏุฏ (ฺฉุงููพูุชุฑ ุฌุฏุฏุ ุณุฑูุฑ ุฌุฏุฏุ ุง ุญุช Replit ุฌุฏุฏ) ุงุฌุฑุง ูโฺฉูุฏุ ุงู ูุฑุงุญู ุฑุง ุฏูุจุงู ฺฉูุฏ:

### ูุฑุญูู 1: ูุตุจ ูพฺฉุฌโูุง (Install Dependencies)
```bash
pip install -r requirements.txt
# ุง ุฏุฑ ุตูุฑุช ุงุณุชูุงุฏู ุงุฒ uv:
# uv sync
```

### ูุฑุญูู 2: ุชูุธู ุฏุชุงุจุณ (Database Configuration)
ุฏู ุฑุงู ุจุฑุง ุชูุธู ุฏุชุงุจุณ ุฏุงุฑุฏ:

#### ุฑุงู ุงูู: ุงุณุชูุงุฏู ุงุฒ Secrets ุฏุฑ Replit
1. ุฏุฑ ูพูู ุณูุช ฺูพ Replitุ ุฑู **Tools** ฺฉูฺฉ ฺฉูุฏ
2. **Secrets** ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ
3. ฺฉ Secret ุฌุฏุฏ ุงุถุงูู ฺฉูุฏ:
   - **Key:** `DATABASE_URL`
   - **Value:** ุขุฏุฑุณ ุฏุชุงุจุณ PostgreSQL ุดูุง

#### ุฑุงู ุฏูู: ุงุณุชูุงุฏู ุงุฒ ูุงู .env (ูุญู)
ูุงู `.env` ุงุฌุงุฏ ฺฉูุฏ ู ุงู ุฎุท ุฑุง ุงุถุงูู ฺฉูุฏ:
```env
DATABASE_URL=postgresql://username:password@host:port/dbname
```

### ูุฑุญูู 3: ุงุฌุฑุง ุงุณฺฉุฑูพุช ุงุณุชูุฑุงุฑ (Run Deployment Script)
```bash
python deploy.py
```

ุงู ุงุณฺฉุฑูพุช ุฎูุฏฺฉุงุฑ ุงูุฌุงู ูโุฏูุฏ:
- โ ุงุฌุงุฏ ุฌุฏุงูู ุฏุชุงุจุณ
- โ ุฑุงูโุงูุฏุงุฒ ุณุณุชู ุฏุณุชุฑุณโูุง (RBAC)
- โ ุงุฌุงุฏ ฺฉุงุฑุจุฑ ูุฏุฑ (admin)
- โ ุจุฑุฑุณ ุตุญุช ูพฺฉุฑุจูุฏ

### ูุฑุญูู 4: ุงุฌุฑุง ุงูพูฺฉุดู (Run Application)
```bash
python main.py
```

ุงูพูฺฉุดู ุฏุฑ ุขุฏุฑุณ `http://localhost:5000` (ุง ูพูุฑุช ฺฉู Replit ุชุนู ูโฺฉูุฏ) ุฏุฑ ุฏุณุชุฑุณ ุฎูุงูุฏ ุจูุฏ.

### ุงุทูุงุนุงุช ูุฑูุฏ ูพุดโูุฑุถ (Default Login)
- **ูุงู ฺฉุงุฑุจุฑ:** `admin`
- **ุฑูุฒ ุนุจูุฑ:** `admin123`
- **ููุด:** ูุฏุฑ ุงุฑุดุฏ (ุฏุณุชุฑุณ ฺฉุงูู ุจู ููู ุจุฎุดโูุง)

### ๐ง ุชุถูู ุฏุณุชุฑุณ ฺฉุงูู Admin
ุงฺฏุฑ ูพุณ ุงุฒ ุฌุงุจุฌุง ูุงูโูุง admin ุฏุณุชุฑุณ ฺฉุงูู ูุฏุงุดุช:

#### ุฑูุด 1: ุงุฌุฑุง ูุฌุฏุฏ deploy.py
```bash
python deploy.py
```

#### ุฑูุด 2: ุงุณฺฉุฑูพุช ุชุตุญุญ ุณุฑุน
```bash
python fix_admin_permissions.py
```

#### ุฑูุด 3: ุชุตุญุญ ุฏุณุช SQL
```bash
python -c "
from app import app, db
from models import User, Role
with app.app_context():
    admin = User.query.filter_by(username='admin').first()
    super_admin = Role.query.filter_by(name='super_admin').first()
    if admin and super_admin:
        admin.role_id = super_admin.id
        db.session.commit()
        print('โ admin ุฏุณุชุฑุณ ฺฉุงูู ุฏุงุฑุฏ')
"
```

---

## ุญู ูุดฺฉูุงุช ุฑุงุฌ (Troubleshooting)

### ูุดฺฉู: "ูุงู ฺฉุงุฑุจุฑ ุง ุฑูุฒ ุนุจูุฑ ุงุดุชุจุงู ุงุณุช"
**ุนูุช:** ฺฉุงุฑุจุฑ admin ุงุฌุงุฏ ูุดุฏู ุงุณุช.
**ุฑุงู ุญู:** ุงุณฺฉุฑูพุช `deploy.py` ุฑุง ุฏูุจุงุฑู ุงุฌุฑุง ฺฉูุฏ.

### ูุดฺฉู: "Could not parse SQLAlchemy URL"
**ุนูุช:** `DATABASE_URL` ุชูุธู ูุดุฏู ุงุณุช.
**ุฑุงู ุญู:** 
1. `DATABASE_URL` ุฑุง ุฏุฑ Secrets ุง ูุงู `.env` ุชูุธู ฺฉูุฏ
2. ุงูพูฺฉุดู ุฑุง restart ฺฉูุฏ

### ูุดฺฉู: "relation does not exist"
**ุนูุช:** ุฌุฏุงูู ุฏุชุงุจุณ ุงุฌุงุฏ ูุดุฏูโุงูุฏ.
**ุฑุงู ุญู:** `python deploy.py` ุฑุง ุงุฌุฑุง ฺฉูุฏ.

---

## ุจุฑุง ุชูุณุนูโุฏููุฏฺฏุงู (For Developers)

### ุณุงุฎุชุงุฑ ูุงูโูุง ููู:
- `deploy.py` - ุงุณฺฉุฑูพุช ุงุณุชูุฑุงุฑ ุฎูุฏฺฉุงุฑ
- `app.py` - ุงูพูฺฉุดู ุงุตู Flask
- `models.py` - ูุฏูโูุง ุฏุชุงุจุณ
- `rbac_setup.py` - ุฑุงูโุงูุฏุงุฒ ุณุณุชู ุฏุณุชุฑุณโูุง
- `.env` - ูุชุบุฑูุง ูุญุท (ูุญู)

### ุงุถุงูู ฺฉุฑุฏู Migration ุฏุฑ ุขูุฏู:
```bash
# ูุตุจ Flask-Migrate
pip install Flask-Migrate

# ุฑุงูโุงูุฏุงุฒ Migration
flask db init

# ุงุฌุงุฏ Migration ุฌุฏุฏ
flask db migrate -m "ุชูุถุญ ุชุบุฑุงุช"

# ุงุนูุงู Migration
flask db upgrade
```

### ุฏุณุชูุฑุงุช ููุฏ:
```bash
# ุงุฌุงุฏ ฺฉุงุฑุจุฑ ุฌุฏุฏ
python -c "from deploy import create_admin_user; create_admin_user()"

# ุจุงุฒูุดุงู ุฏุชุงุจุณ
python -c "from app import app, db; import models; app.app_context().push(); db.drop_all(); db.create_all()"

# ุจุฑุฑุณ ูุถุนุช ุฏุชุงุจุณ
python -c "from app import app, db; from models import User; app.app_context().push(); print(f'ุชุนุฏุงุฏ ฺฉุงุฑุจุฑุงู: {User.query.count()}')"
```

---

## ูฺฉุงุช ุงููุช (Security Notes)

โ๏ธ **ููู:** ุฏุฑ ูุญุท production:
1. ุฑูุฒ ุนุจูุฑ admin ุฑุง ุชุบุฑ ุฏูุฏ
2. SECRET_KEY ูู ุชูุธู ฺฉูุฏ
3. ุงุฒ HTTPS ุงุณุชูุงุฏู ฺฉูุฏ
4. ุฏุณุชุฑุณโูุง ุบุฑุถุฑูุฑ ุฑุง ุญุฐู ฺฉูุฏ

---

## ูพุดุชุจุงู (Support)

ุฏุฑ ุตูุฑุช ุจุฑูุฒ ูุดฺฉู:
1. ุงุจุชุฏุง `deploy.py` ุฑุง ุฏูุจุงุฑู ุงุฌุฑุง ฺฉูุฏ
2. ูุงฺฏโูุง ุงูพูฺฉุดู ุฑุง ุจุฑุฑุณ ฺฉูุฏ
3. ุงุทููุงู ุญุงุตู ฺฉูุฏ ฺฉู `DATABASE_URL` ุฏุฑุณุช ุชูุธู ุดุฏู ุงุณุช

ุงู ุฑุงูููุง ุชุถูู ูโฺฉูุฏ ฺฉู ูุฑ ููุช ูพุฑูฺู ุฑุง ุจู ูุญุท ุฌุฏุฏ ููุชูู ฺฉูุฏุ ุชููุง ุจุง ฺูุฏ ุฏุณุชูุฑ ุณุงุฏูุ ฺฉุงููุงู ุขูุงุฏู ฺฉุงุฑ ุดูุฏ.